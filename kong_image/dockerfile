FROM kong:2.8.1-alpine
USER root
#RUN cp /etc/kong/kong.conf.default /etc/kong/kong.conf
#RUN export KONG_DATABASE = off
#RUN export KONG_PROXY_ACCESS_LOG=/dev/stdout
#RUN export KONG_ADMIN_ACCESS_LOG=/dev/stdout
#RUN export KONG_PROXY_ERROR_LOG=/dev/stderr
#RUN export KONG_ADMIN_ERROR_LOG=/dev/stderr
#RUN export KONG_ADMIN_LISTEN=0.0.0.0:8001
ARG KONG_DATABASE off
ARG KONG_PROXY_ACCESS_LOG /dev/stdout
ARG KONG_ADMIN_ACCESS_LOG /dev/stdout
ARG KONG_PROXY_ERROR_LOG /dev/stderr
ARG KONG_ADMIN_ERROR_LOG /dev/stderr
ARG KONG_ADMIN_LISTEN 0.0.0.0:8001
ARG KONG_DECLARATIVE_CONFIG_STRING '{"_format_version": "2.1", "_transform": "true", "services":[{"name": "kong_blazegraph", "url": "http://kong_blazegraph:8080/bigdata/#splash", "routes": [{"name": "kong_blazegraph_routes_home","strip_path": "true","paths":["/graph/hello"],"methods":["GET"]}]},{"name":"kong_blazegraph_api_query_post","url": "http://kong_blazegraph:8080/bigdata/sparql","routes":[{"name":"kong_blazegraph_routes_query_post","strip_path": "true","preserve_host": "true","paths":["/graph?"],"methods":["GET"]}]},{"name":"kong_blazegraph_api_query_post_full_access","url":"http://kong_blazegraph:8080/bigdata/sparql/","routes":[{"name":"kong_blazegraph_routes_query_post_full_access","strip_path":"true","preserve_host":"true","paths":["/graph-full-access?"],"methods":["GET","POST","DELETE"]}]},{"name":"kong_miiify","url":"https://kong_miiify:8080","routes":[{"name":"kong_miiify_routes_home","strip_path":"true","paths":["/annotation/hello"],"methods":["GET"]}]},{"name":"kong_miiify_add_anotation","url":"https://kong_miiify:8080/annotations/","routes":[{"name":"kong_miiify_routes_add_annotation","strip_path":"true","preserve_host":"true","paths":["/annotation/"],"methods":["POST","GET","PUT","DELETE"]}]},{"name":"iiif_manifest","url":"http://ohos-iiif-manifest:5000","routes":[{"name":"ohos-iiif-manifest","strip_path":"true","preserve_host":"true","paths":["/manifest/"],"methods":["GET"]}]}]}'
EXPOSE 8000
EXPOSE 8443
EXPOSE 8001
EXPOSE 8444
CMD ["kong", "start"]
#RUN export KONG_DECLARATIVE_CONFIG_STRING='{"_format_version": "2.1", "_transform": "true", "services":[{"name": "kong_blazegraph", "url": "http://kong_blazegraph:8080/bigdata/#splash", "routes": [{"name": "kong_blazegraph_routes_home","strip_path": "true","paths":["/graph/hello"],"methods":["GET"]}]},{"name":"kong_blazegraph_api_query_post","url": "http://kong_blazegraph:8080/bigdata/sparql","routes":[{"name":"kong_blazegraph_routes_query_post","strip_path": "true","preserve_host": "true","paths":["/graph?"],"methods":["GET"]}]},{"name":"kong_blazegraph_api_query_post_full_access","url":"http://kong_blazegraph:8080/bigdata/sparql/","routes":[{"name":"kong_blazegraph_routes_query_post_full_access","strip_path":"true","preserve_host":"true","paths":["/graph-full-access?"],"methods":["GET","POST","DELETE"]}]},{"name":"kong_miiify","url":"https://kong_miiify:8080","routes":[{"name":"kong_miiify_routes_home","strip_path":"true","paths":["/annotation/hello"],"methods":["GET"]}]},{"name":"kong_miiify_add_anotation","url":"https://kong_miiify:8080/annotations/","routes":[{"name":"kong_miiify_routes_add_annotation","strip_path":"true","preserve_host":"true","paths":["/annotation/"],"methods":["POST","GET","PUT","DELETE"]}]},{"name":"iiif_manifest","url":"http://ohos-iiif-manifest:5000","routes":[{"name":"ohos-iiif-manifest","strip_path":"true","preserve_host":"true","paths":["/manifest/"],"methods":["GET"]}]}]}'
#COPY kong.yml /
#RUN KONG_DECLARATIVE_CONFIG=kong.yml
#RUN cp /etc/kong/kong.conf.default /etc/kong/kong.conf
#FROM docker:20.10.17-dind
#RUN docker run docker
#RUN docker exec kong start -c kong.conf
#RUN exec kong start -c kong.conf
#RUN kong start